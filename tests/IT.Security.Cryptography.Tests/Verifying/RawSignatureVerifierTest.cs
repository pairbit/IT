namespace IT.Security.Cryptography.Tests.Verifying;

public abstract class RawSignatureVerifierTest
{
    private readonly IRawSignatureVerifier _rawSignatureVerifier;

    public RawSignatureVerifierTest(IRawSignatureVerifier rawSignatureVerifier)
    {
        _rawSignatureVerifier = rawSignatureVerifier;
    }

    [Test]
    public void Verify()
    {
        var gost256 = "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";

        Verify(
            "01F73EF4D98739FF9E130C9E8E1A4E446E22CFE2682FF3CE2C5DBBA16103EEF03747CF19728C7AC6CF928A32FB77019F46CC139936A9C26CE36A9A0DCFD76B0D",
            "918ECDCAD236F612B51B5787861C33BE8F0E13401F182442FA99690EBB1D1998", gost256);

        Verify(
            "201857EFE67057E89631C14AAE62A4DF0A7B4D7FFFA16DE80A7EDA6326E3A00C1B0733B01AFA8DFE7A5DAD2C09FF1ED651CD1F1BC7582EE5BFFFB665F5134B04",
            "9D6C3DC0847789B6CC7587585BE35F817B0A3DBE01D970961CE0E44F126D8A4C", gost256);
    }

    public void Verify(String signatureHex, String hashHex, String certificateBase64)
    {
        var signature = Convert.FromHexString(signatureHex).Reverse().ToArray();
        var hash = Convert.FromHexString(hashHex);
        var certificate = Convert.FromBase64String(certificateBase64);

        Assert.True(_rawSignatureVerifier.Verify(signature, hash, certificate));
    }
}